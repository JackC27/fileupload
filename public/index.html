<!DOCTYPE html>
<head>
  <script src="https://unpkg.com/react@16/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js" crossorigin></script>
</head>
<body>

  <div id="app">

  </div>

<script type="text/babel">
  console.log(" START ");
  
  class Test extends React.Component {
    constructor(props) {
      super(props)
      this.state = {
        uploaded: false,
        file: null,
        filename: null
      }
      this.fileUploadHandler = this.fileUploadHandler.bind(this);
      this.handleChange = this.handleChange.bind(this);
    }

    fileUploadHandler(){      
      let fd = new FormData();
      fd.append("image201", this.state.file, this.state.file.name);
      
      //add text for fun
      fd.append("random", "text"); 

      //create fetch request now
      fetch("/dynamic-image", {
        method: 'POST',      
        data: fd,
        body: fd
      })
      .then( res => {
        //update state for image upload
        this.setState({uploaded: true});
      })
      .catch(e => console.log("ERROR ", e));
    }

    handleChange(event){
      this.setState({file: event.target.files[0]});
    }

    render() {
      return (
        <div>

          {/*create file upload using form element*/}
          <form action="/image" method="POST" enctype="multipart/form-data" id='form'>
            <input onChange={this.handleChange} type="file" name="image101" />
            <input type="text" name="test"/>
            <input type="submit" value="submit" name="testphoto"/>
            <hr />          
          </form>

          {/*create file upload without html form element*/}
          <input onChange={this.handleChange} type="file" name="image201" />
          <button onClick={this.fileUploadHandler}>Upload</button>
        </div>
      )
    }
  }  

  ReactDOM.render(<Test />, document.getElementById('app'))
  </script>
  <script src="index.js"></script>

</body>

